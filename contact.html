<!doctype html>
<html lang="ja">
  <!-- サイトに関する設定事項を記述します -->
  <head id="head">
    <!-- 文字コードの指定 -->
    <meta charset="utf-8" />

    <!-- ページのタイトル -->
    <title>お問い合わせ - WAVE</title>

    <!-- ビューポート(視点)の指定 -->
    <meta name="viewport" content="width=device-width" />

    <!-- ファビコンの指定 https://ao-system.net/favicongenerator/ -->
    <link rel="icon" href="images/favicon.ico" type="image/ico" />
    <link
      rel="apple-touch-icon"
      href="images/apple-touch-icon-180x180.png"
      type="image/png"
      sizes="180x180"
    />

    <!-- 検索時に表示される、ウェブサイトの要約文 -->
    <meta
      name="description"
      content="概ね80文字前後のサイトの
    紹介文が、検索時に表示されます。"
    />

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Yuji+Boku&display=swap"
    />

    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v7.1.0/css/all.css"
    />

    <!-- Reset CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@acab/reset.css@0.11.0/index.min.css"
    />

    <!-- 自分で作ったスタイルシート -->
    <link rel="stylesheet" href="stylesheets/master.css" />

    <!-- 先頭へ戻るボタンの為のJavaScript -->
    <script src="javascripts/page-top.js" defer></script>

    <!-- 部分ファイルを読み込む -->
    <script src="include.js"></script>

    <!-- モーダルウィンドウ用のJavaScript -->
    <script
      src="https://unpkg.com/micromodal/dist/micromodal.min.js"
      defer
    ></script>
    <script src="javascripts/modal.js" defer></script>

    <!-- Google reCAPTCHA v3 -->
    <script src="https://www.google.com/recaptcha/api.js?render=6Lda9vArAAAAADeKagqVWNV8PEZKND3-TjOnDUZ9" async defer></script>

    <style>
      /* ===== Contact Page Layout ===== */
      body.contact-page {
        --surface: #ffffff;
        --surface-alt: #f8f9fc;
        --accent: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --accent-solid: #667eea;
        --text: #1a1a2e;
        --text-muted: #64748b;
        --border: #e2e8f0;
        --radius: 20px;
        --shadow: 0 4px 24px rgba(0,0,0,0.06);
        --shadow-lg: 0 20px 60px rgba(0,0,0,0.1);
        --success: #10b981;
        --error: #ef4444;

        display: flex;
        flex-direction: column;
        min-height: 100vh;
        font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif;
      }

      body.contact-page main {
        flex: 1;
        width: 100%;
        max-width: 800px;
        margin: 0 auto;
        padding: clamp(1rem, 4vw, 3rem);
      }

      body.contact-page article {
        display: grid;
        gap: clamp(1.5rem, 4vw, 2.5rem);
      }

      /* ===== Hero Section ===== */
      body.contact-page .contact-hero {
        text-align: center;
        padding: clamp(2rem, 6vw, 4rem) clamp(1rem, 4vw, 2rem);
        background: var(--surface);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
      }

      body.contact-page .contact-hero h1 {
        font-family: "Yuji Boku", serif;
        font-size: clamp(1.75rem, 4vw, 2.5rem);
        background: var(--accent);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin: 0 0 1rem;
      }

      body.contact-page .contact-hero p {
        color: var(--text-muted);
        line-height: 1.8;
        max-width: 50ch;
        margin: 0 auto;
      }

      body.contact-page .contact-hero .icon-circle {
        width: 80px;
        height: 80px;
        margin: 0 auto 1.5rem;
        background: var(--accent);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        color: #fff;
      }

      /* ===== Form Card ===== */
      body.contact-page .form-card {
        background: var(--surface);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        padding: clamp(1.5rem, 4vw, 2.5rem);
      }

      body.contact-page form {
        display: grid;
        gap: 1.5rem;
      }

      /* ===== Form Groups ===== */
      body.contact-page .form-group {
        position: relative;
      }

      body.contact-page .form-group label {
        display: block;
        font-weight: 600;
        color: var(--text);
        margin-bottom: 0.5rem;
        font-size: 0.95rem;
      }

      body.contact-page .form-group label .required {
        color: var(--error);
        margin-left: 0.25rem;
      }

      body.contact-page .form-group input,
      body.contact-page .form-group textarea {
        width: 100%;
        padding: 1rem 1.25rem;
        border: 2px solid var(--border);
        border-radius: 12px;
        font-size: 1rem;
        font-family: inherit;
        background: var(--surface);
        color: var(--text);
        transition: all 0.2s ease;
      }

      body.contact-page .form-group input:focus,
      body.contact-page .form-group textarea:focus {
        outline: none;
        border-color: var(--accent-solid);
        box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.15);
      }

      body.contact-page .form-group textarea {
        min-height: 180px;
        resize: vertical;
      }

      body.contact-page .form-group input::placeholder,
      body.contact-page .form-group textarea::placeholder {
        color: #a0aec0;
      }

      /* ===== Validation States ===== */
      body.contact-page .form-group.valid input,
      body.contact-page .form-group.valid textarea {
        border-color: var(--success);
      }

      body.contact-page .form-group.invalid input,
      body.contact-page .form-group.invalid textarea {
        border-color: var(--error);
      }

      body.contact-page .form-group .message {
        display: none;
        font-size: 0.85rem;
        margin-top: 0.5rem;
        padding-left: 0.25rem;
      }

      body.contact-page .form-group .message.error {
        color: var(--error);
      }

      body.contact-page .form-group .message.success {
        color: var(--success);
      }

      body.contact-page .form-group.invalid .message.error {
        display: flex;
        align-items: center;
        gap: 0.35rem;
      }

      body.contact-page .form-group.valid .message.success {
        display: flex;
        align-items: center;
        gap: 0.35rem;
      }

      /* ===== Submit Button ===== */
      body.contact-page .submit-btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.75rem;
        padding: 1rem 2.5rem;
        background: #9ca3af;
        color: #fff;
        border: none;
        border-radius: 50px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: not-allowed;
        transition: all 0.3s ease;
        box-shadow: none;
        margin-top: 1rem;
      }

      body.contact-page .submit-btn.enabled {
        background: var(--accent);
        cursor: pointer;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
      }

      body.contact-page .submit-btn.enabled:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.5);
      }

      body.contact-page .submit-btn.enabled:active {
        transform: translateY(0);
      }

      body.contact-page .submit-btn:disabled {
        background: #9ca3af;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      /* ===== Privacy Button ===== */
      body.contact-page .privacy-btn {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem 1.5rem;
        background: var(--surface-alt);
        color: var(--text-muted);
        border: 2px solid var(--border);
        border-radius: 50px;
        font-size: 0.9rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      body.contact-page .privacy-btn:hover {
        border-color: var(--accent-solid);
        color: var(--accent-solid);
      }

      /* ===== Form Footer ===== */
      body.contact-page .form-footer {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        justify-content: space-between;
        gap: 1rem;
        padding-top: 1rem;
        border-top: 1px solid var(--border);
      }

      body.contact-page .form-note {
        font-size: 0.85rem;
        color: var(--text-muted);
        max-width: 35ch;
      }

      /* ===== reCAPTCHA ===== */
      body.contact-page .recaptcha-wrapper {
        display: flex;
        justify-content: center;
        margin: 1rem 0;
      }

      /* ===== Modal Styling ===== */
      body.contact-page .modal-overlay {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 2rem 1rem;
      }

      body.contact-page .modal-container {
        border-radius: var(--radius);
        max-width: 500px;
        background: var(--surface);
        margin: auto;
      }

      body.contact-page .modal-header {
        background: var(--surface-alt);
        border-radius: var(--radius) var(--radius) 0 0;
        padding: 1rem 1.5rem;
      }

      body.contact-page .modal-title {
        font-family: "Yuji Boku", serif;
      }

      body.contact-page .modal-content {
        padding: 1.5rem;
        background: var(--surface);
      }

      body.contact-page .modal-content p {
        margin-bottom: 1rem;
        line-height: 1.8;
        color: var(--text);
      }

      body.contact-page .modal-content p:last-child {
        margin-bottom: 0;
      }

      body.contact-page .modal-footer {
        padding: 1rem 1.5rem;
        background: var(--surface-alt);
        border-radius: 0 0 var(--radius) var(--radius);
      }

      /* ===== Footer ===== */
      body.contact-page #footer {
        margin-top: auto;
      }

      /* ===== Hidden ===== */
      body.contact-page .hidden {
        display: none !important;
      }
    </style>
  </head>

  <!-- 表示したい内容・出し物・コンテンツを記述します -->
  <body class="contact-page">
    <!-- ヘッダー(サイト名) -->
    <header id="header"></header>
    <script>
      include("header");
    </script>

    <!-- ナビゲーションメニュー -->
    <nav id="navigation"></nav>
    <script>
      include("navigation");
    </script>

    <!-- 主要なコンテンツ -->
    <main>
      <!-- 投稿記事 -->
      <article>
        <!-- Hero Section -->
        <div class="contact-hero">
          <div class="icon-circle">
            <i class="fa-solid fa-envelope"></i>
          </div>
          <h1>お問い合わせ</h1>
          <p>
            ご意見・ご感想など、以下の欄にご記入の上、送信してください。
            記事に関するご質問などもお気軽にお寄せください。
          </p>
        </div>

        <!-- Form Card -->
        <div class="form-card">
          <form
            name="contact"
            action="https://ssgform.com/s/G72D9M88AyCi"
            method="POST"
            id="contact-form"
          >
            <!-- Hidden fields -->
            <input type="hidden" id="referrer_url" name="referrer_url" />
            <input type="hidden" name="g-recaptcha-response" id="g-recaptcha-response" />

            <!-- Message -->
            <div class="form-group" data-validate="required">
              <label for="message">
                お問い合わせ内容
                <span class="required">*</span>
              </label>
              <textarea
                id="message"
                name="message"
                placeholder="ご質問やご意見をお聞かせください"
                required
                autocapitalize="none"
                autocorrect="off"
              ></textarea>
              <span class="message error">
                <i class="fa-solid fa-circle-exclamation"></i>
                お問い合わせ内容を入力してください
              </span>
              <span class="message success">
                <i class="fa-solid fa-circle-check"></i>
                OK
              </span>
            </div>

            <!-- Name -->
            <div class="form-group" data-validate="required">
              <label for="name">
                お名前
                <span class="required">*</span>
              </label>
              <input
                type="text"
                id="name"
                name="name"
                placeholder="山田 太郎"
                required
                autocomplete="name"
              />
              <span class="message error">
                <i class="fa-solid fa-circle-exclamation"></i>
                お名前を入力してください
              </span>
              <span class="message success">
                <i class="fa-solid fa-circle-check"></i>
                OK
              </span>
            </div>

            <!-- Email -->
            <div class="form-group" data-validate="email">
              <label for="email">
                メールアドレス
                <span class="required">*</span>
              </label>
              <input
                type="email"
                id="email"
                name="email"
                placeholder="taro@example.com"
                required
                autocomplete="email"
              />
              <span class="message error">
                <i class="fa-solid fa-circle-exclamation"></i>
                正しいメールアドレスを入力してください
              </span>
              <span class="message success">
                <i class="fa-solid fa-circle-check"></i>
                OK
              </span>
            </div>

            <!-- Phone -->
            <div class="form-group" data-validate="tel">
              <label for="tel">
                電話番号
                <span style="color: var(--text-muted); font-weight: 400;">（任意）</span>
              </label>
              <input
                type="tel"
                id="tel"
                name="tel"
                placeholder="052-373-4649"
                autocomplete="tel"
                maxlength="13"
                minlength="7"
                pattern="^(\d|-|\(|\))*$"
              />
              <span class="message error">
                <i class="fa-solid fa-circle-exclamation"></i>
                正しい形式で入力してください
              </span>
              <span class="message success">
                <i class="fa-solid fa-circle-check"></i>
                OK
              </span>
            </div>

            <!-- Form Footer -->
            <div class="form-footer">
              <button
                type="button"
                class="privacy-btn"
                data-micromodal-trigger="privacy-modal"
              >
                <i class="fa-solid fa-shield-halved"></i>
                お預かりする情報の取り扱い
              </button>

              <button type="submit" class="submit-btn" disabled>
                <i class="fa-solid fa-paper-plane"></i>
                送信する
              </button>
            </div>

            <p class="form-note" style="margin-top: 1rem; text-align: center;">
              ご入力内容は本お問い合わせ対応以外の目的では利用いたしません。
            </p>
          </form>
        </div>

        <!-- お預かりする情報の取り扱い（モーダル） -->
        <div class="modal" id="privacy-modal" aria-hidden="true">
          <div class="modal-overlay" tabindex="-1" data-micromodal-close>
            <div
              class="modal-container"
              role="dialog"
              aria-modal="true"
              aria-labelledby="privacy-modal-title"
            >
              <header class="modal-header">
                <h2 class="modal-title" id="privacy-modal-title">
                  お預かりする情報の取り扱い
                </h2>
                <button
                  class="modal-close"
                  aria-label="閉じる"
                  data-micromodal-close
                >
                  &times;
                </button>
              </header>
              <div class="modal-content" id="privacy-modal-content">
                <p>
                  このお問い合わせフォームで入力いただいた内容は、回答およびご連絡の目的にのみ使用します。
                </p>
                <p>
                  取得した個人情報を第三者に提供することはありません（法令に基づく場合を除きます）。
                </p>
              </div>
              <footer class="modal-footer">
                <button
                  class="simple button"
                  type="button"
                  data-micromodal-close
                >
                  閉じる
                </button>
              </footer>
            </div>
          </div>
        </div>
      </article>
    </main>

    <!-- フッター -->
    <footer id="footer"></footer>
    <script>
      include("footer");
    </script>

    <!-- Form Validation & reCAPTCHA Script -->
    <script>
      (function() {
        // Set referrer URL
        var referrerField = document.getElementById("referrer_url");
        if (referrerField && !referrerField.value) {
          referrerField.value = document.referrer || window.location.href;
        }

        // reCAPTCHA v3
        var siteKey = "6Lda9vArAAAAADeKagqVWNV8PEZKND3-TjOnDUZ9";

        function requestToken(action, onToken, onError) {
          if (!window.grecaptcha || typeof window.grecaptcha.ready !== "function") {
            setTimeout(function() { requestToken(action, onToken, onError); }, 150);
            return;
          }

          window.grecaptcha.ready(function() {
            window.grecaptcha.execute(siteKey, { action: action })
              .then(function(token) {
                onToken(token);
              })
              .catch(function(error) {
                if (typeof onError === "function") {
                  onError(error);
                } else {
                  console.error("reCAPTCHA token request failed", error);
                }
              });
          });
        }

        // Form validation
        document.addEventListener("DOMContentLoaded", function() {
          var form = document.getElementById("contact-form");
          if (!form) return;

          var formGroups = form.querySelectorAll(".form-group[data-validate]");
          var submitBtn = form.querySelector(".submit-btn");
          var tokenField = form.querySelector("input[name='g-recaptcha-response']");

          // Request initial token
          function updateToken(token) {
            if (tokenField) tokenField.value = token;
          }
          requestToken("contact_form", updateToken);

          // Validation functions
          function validateRequired(value) {
            return value.trim().length > 0;
          }

          function validateEmail(value) {
            if (!value.trim()) return false;
            var emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(value);
          }

          function validateTel(value) {
            if (!value.trim()) return true; // Optional field
            var telRegex = /^(\d|-|\(|\))*$/;
            return telRegex.test(value) && value.length >= 7;
          }

          function validateField(formGroup) {
            var input = formGroup.querySelector("input, textarea");
            if (!input) return true;

            var validationType = formGroup.dataset.validate;
            var value = input.value;
            var isValid = true;

            switch (validationType) {
              case "required":
                isValid = validateRequired(value);
                break;
              case "email":
                isValid = validateEmail(value);
                break;
              case "tel":
                isValid = validateTel(value);
                break;
            }

            // Update UI
            formGroup.classList.remove("valid", "invalid");
            if (value.trim()) {
              formGroup.classList.add(isValid ? "valid" : "invalid");
            }

            return isValid;
          }

          // Check if all required fields are valid
          function checkAllRequiredValid() {
            var allValid = true;
            formGroups.forEach(function(formGroup) {
              var input = formGroup.querySelector("input, textarea");
              if (input && input.hasAttribute("required")) {
                var validationType = formGroup.dataset.validate;
                var value = input.value;
                var isValid = true;

                switch (validationType) {
                  case "required":
                    isValid = validateRequired(value);
                    break;
                  case "email":
                    isValid = validateEmail(value);
                    break;
                  case "tel":
                    isValid = validateTel(value);
                    break;
                }

                if (!isValid) {
                  allValid = false;
                }
              }
            });
            return allValid;
          }

          // Update submit button state
          function updateSubmitButton() {
            if (checkAllRequiredValid()) {
              submitBtn.disabled = false;
              submitBtn.classList.add("enabled");
            } else {
              submitBtn.disabled = true;
              submitBtn.classList.remove("enabled");
            }
          }

          // Add event listeners for real-time validation
          formGroups.forEach(function(formGroup) {
            var input = formGroup.querySelector("input, textarea");
            if (input) {
              input.addEventListener("blur", function() {
                validateField(formGroup);
                updateSubmitButton();
              });

              input.addEventListener("input", function() {
                if (formGroup.classList.contains("invalid") || formGroup.classList.contains("valid")) {
                  validateField(formGroup);
                }
                updateSubmitButton();
              });
            }
          });

          // Form submit with reCAPTCHA
          form.addEventListener("submit", function(event) {
            event.preventDefault();

            var allValid = true;
            formGroups.forEach(function(formGroup) {
              var input = formGroup.querySelector("input, textarea");
              if (input && input.hasAttribute("required")) {
                if (!validateField(formGroup)) {
                  allValid = false;
                }
              } else {
                validateField(formGroup);
              }
            });

            if (!allValid) {
              var firstInvalid = form.querySelector(".form-group.invalid input, .form-group.invalid textarea");
              if (firstInvalid) {
                firstInvalid.focus();
              }
              return;
            }

            // Request fresh token before submit
            requestToken(
              "contact_form_submit",
              function(token) {
                updateToken(token);
                form.submit();
              },
              function(error) {
                console.error("reCAPTCHA execution failed", error);
                alert("reCAPTCHAの検証に失敗しました。時間を置いて再度お試しください。");
              }
            );
          });
        });
      })();
    </script>
  </body>
</html>
